---
title: "ãƒ–ãƒ­ã‚°ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸ"
postdate: "2022-01-05"
update: "2022-03-11"
seriesName: "æ—¥è¨˜"
seriesSlug: "Diary"
description: "å½“ãƒ–ãƒ­ã‚°ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸã®ã§è¨˜äº‹ã«ã—ã¾ã™ã€‚"
tags: ["Gatsby", "Gatsby Blog"]
keywords: ["Gatsby", "Blog", "ãƒ–ãƒ­ã‚°", "React Hooks"]
published: true
---

# ãƒ–ãƒ­ã‚°ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸ

ã‚¿ã‚¤ãƒˆãƒ«ã®ã¾ã‚“ã¾ã§ã™ã€‚å³ä¸Šã«ã‚ã‚‹è™«çœ¼é¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚Œã°ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ãŒç¾ã‚Œã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹è¨˜äº‹ã®çµã‚Šè¾¼ã¿æ¤œç´¢ãŒã§ãã¾ã™ã€‚

çµã‚Šè¾¼ã¿æ¤œç´¢ã¯ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒã¨ã‚‚å‘¼ã°ã‚Œã€ãƒšãƒ¼ã‚¸é·ç§»ã‚’ä¼´ã†ã“ã¨ãªãæ®µéšçš„ã«è¨˜äº‹ã‚’çµã‚Šè¾¼ã‚“ã§ã„ãã¾ã™ã€‚

ã€Œgã€ã¨å…¥åŠ›ã—ãŸå ´åˆï¼ˆ10ä»¶ï¼‰ã€‚

![](./images/image01.png)

ã€Œgitã€ã¨å…¥åŠ›ã—ãŸå ´åˆï¼ˆ4ä»¶ï¼‰ã€‚

![](./images/image02.png)

ã€Œgit logã€ã¨å…¥åŠ›ã—ãŸå ´åˆï¼ˆ3ä»¶ï¼‰ã€‚

![](./images/image03.png)

ã“ã®ãƒ–ãƒ­ã‚°ã¯æ—¢ã«ã‚·ãƒªãƒ¼ã‚ºæ¤œç´¢ã¨ã‚¿ã‚°æ¤œç´¢ã®æ©Ÿèƒ½ã‚’æŒã£ã¦ãŠã‚Šã“ã‚Œä»¥ä¸Šã®æ¤œç´¢æ©Ÿèƒ½ã¯ä¸è¦ã‹ã¨æ€ã£ãŸã®ã§ã™ãŒã€å¹´æœ«å¹´å§‹ãŒéå¸¸ã«æš‡ã ã£ãŸã“ã¨ã‚‚ã‚ã‚Šå®Ÿè£…ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯ã“ã®æ¤œç´¢æ©Ÿèƒ½ã«ã¤ã„ã¦ã€ãã—ã¦ãã®å®Ÿè£…æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

## JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ¤œç´¢ã™ã‚‹

ã•ã¦ã€é™çš„ã‚µã‚¤ãƒˆã§ã®æ¤œç´¢æ©Ÿèƒ½ã¨ã„ãˆã°[algolia](https://www.algolia.com/)ãŒçœŸã£å…ˆã«æ€ã„æµ®ã‹ã³ã¾ã™ã­ã€‚ç§ã‚‚åˆ©ç”¨ã—ã‚ˆã†ã¨æ€ã£ã¦è‰²ã€…èª¿ã¹ã¦ã¿ãŸã®ã§ã™ãŒã€

- ğŸ¤” algoliaã«é–¢ã™ã‚‹çŸ¥è­˜ãŒå…¨ããªã„
- ğŸ¤” æ–™é‡‘ãŒã‹ã‹ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ 
- ğŸ¤” Saasãªã©ã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã®ã¯å¤§ã’ã•
- ğŸ¤” å…¨æ–‡æ¤œç´¢ã¯å¿…è¦ãªã„

ãªã©ã®ç†ç”±ã‹ã‚‰å°å…¥ã¯ã—ãªã„ã“ã¨ã«ã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€Gatsbyã®ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹æ™‚ã«å„è¨˜äº‹ã®frontmatterã‹ã‚‰JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã™ã‚‹ã€ã¨ã„ã†è‡³æ¥µã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã‚’ã¨ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

## frontmatterã«keywordsã‚’è¿½åŠ ã™ã‚‹

æ¬¡ã«ã€æ¤œç´¢å¯¾è±¡ã‚’ã©ã†ã—ã‚ˆã†ã‹ã¨è€ƒãˆã¾ã—ãŸã€‚ã±ã£ã¨æ€ã„ã¤ãã®ã¯

- ğŸ” è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
- ğŸ” ã‚·ãƒªãƒ¼ã‚ºå
- ğŸ” ã‚¿ã‚°
- ğŸ” description
- ğŸ” è¨˜äº‹æœ¬æ–‡ï¼ˆå…¨æ–‡æ¤œç´¢ï¼‰

ãã‚‰ã„ã§ã™ãŒã€å…¨ã¦ã‚’å¯¾è±¡ã«ã™ã‚‹ã¨ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ã«ãªã‚‹ã†ãˆJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚‚è‚¥å¤§åŒ–ã™ã‚‹ã®ã§ã‚„ã‚ã¾ã—ãŸã€‚è¨˜äº‹æœ¬æ–‡ã‚‚JSONãƒ•ã‚¡ã‚¤ãƒ«ã®è‚¥å¤§åŒ–ã€ãã—ã¦ãã“ã¾ã§å¿…è¦ãªã„ã¨ã„ã†ç†ç”±ã§å´ä¸‹ã€‚ã‚·ãƒªãƒ¼ã‚ºåã€ã‚¿ã‚°åã«ã‚ˆã‚‹æ¤œç´¢ã‚‚ã»ã¼åŒã˜æ©Ÿèƒ½ãŒæ—¢ã«ã‚ã‚‹ã®ã§å´ä¸‹ã€‚ã‚¿ã‚¤ãƒˆãƒ«ã‚„descriptionã¯æ¤œç´¢å¯¾è±¡ã¨ã—ã¦ã¯æƒ…å ±é‡ãŒä¸è¶³ã™ã‚‹ã¨ã„ã†ã“ã¨ã§å´ä¸‹ã€‚

ã„ãã¤ã‹ã®è¦ç´ ã‚’çµ„ã¿åˆã‚ã›ã‚ˆã†ã‹ã¨ã‚‚æ€ã„ã¾ã—ãŸãŒã€ã‚°ã‚¿ã‚°ã‚¿è€ƒãˆã‚‹ãã‚‰ã„ãªã‚‰frontmatterã«æ–°ã—ã„é …ç›®ã‚’è¿½åŠ ã—ã¦ã—ã¾ãŠã†ã¨ã„ã†ã“ã¨ã§ã€ã€Œkeywordsã€ã¨ã„ã†é …ç›®ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ãªã‚‹å˜èªã‚’é…åˆ—ã«æ ¼ç´ã—ã¦ã„ãã¾ã™ã€‚

è¿½åŠ ã™ã‚‹è¨€è‘‰ã¯ã€Œã‚¿ã‚°ã‚ˆã‚Šã‚‚ç²’åº¦ã®ç´°ã‹ã„è¨€è‘‰ã€ã«ã—ã¾ã—ãŸã€‚ã‚¿ã‚°ã«ã™ã‚‹ã»ã©ã§ã¯ãªã„ã‘ã©æœ¬æ–‡ã«ä½•å›ã‹å‡ºç¾ã™ã‚‹è¨€è‘‰ã§ã™ã­ã€‚ã‚¿ã‚°ã¨æœ¬æ–‡ã®ä¸­é–“ãã‚‰ã„ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

ã¾ãŸã€ã€ŒBlogã€ã€Œãƒ–ãƒ­ã‚°ã€ãªã©ã®æ—¥æœ¬èª/è‹±èªã®ã‚†ã‚Œã€ã€ŒSSGã€ã€ŒStatic Site Generatorã€ãªã©ã®ç•¥ã™/ç•¥ã•ãªã„ã¨ã„ã†ã‚†ã‚Œã¯ã‚¿ã‚°æ¤œç´¢ã§ã¯å®Ÿç¾ã—ã«ãã„ã§ã™ã€‚æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹åˆ©ç‚¹ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã«ãªã‚‹ã¨æ€ã„ã€é¢å€’è‡­ã„ã§ã™ãŒç´°ã‹ã«è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚

```yaml
---
# ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜
keywords: ["Gatsby", "Blog", "ãƒ–ãƒ­ã‚°", "SSG", "Static Site Generator"]
---
```

## è¦ä»¶å®šç¾©

ã“ã“ã§ã€ç°¡å˜ã«è¦ä»¶å®šç¾©ã‚’ã—ã¦ãŠãã¾ã™ã€‚

- âœ”ï¸ å…¥åŠ›ã—ãŸæ–‡å­—åˆ—ã‚’ã€Œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ã¨ã—ã¦æŒã£ã¦ã„ã‚‹è¨˜äº‹ã‚’æ¤œç´¢ã—ã€ãã®è¨˜äº‹ã¸ã®ãƒªãƒ³ã‚¯ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹
- âœ”ï¸ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã€å„è¨˜äº‹ã®frontmatterã¨ã—ã¦å®šç¾©ã™ã‚‹
- âœ”ï¸ åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç”¨ã„ã¦è¤‡æ•°ã®å˜èªã‚’å…¥åŠ›å¯èƒ½ã«ã™ã‚‹
- âœ”ï¸ è¤‡æ•°ã®æ–‡å­—åˆ—ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã¯ANDæ¤œç´¢ã‚’è¡Œã†ï¼ˆAAA BBBã¨å…¥åŠ›ã•ã‚Œã‚Œã°ã€ãã®ä¸¡æ–¹ã‚’æŒã£ã¦ã„ã‚‹è¨˜äº‹ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ï¼‰
- âœ”ï¸ è‹±èªã€æ—¥æœ¬èªã‚’å…¥åŠ›å¯¾è±¡ã¨ã™ã‚‹
- âœ”ï¸ ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã¯ã‚±ãƒ¼ã‚¹ãƒ»ã‚¤ãƒ³ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ï¼ˆæ¤œç´¢æ™‚ã«å¤§æ–‡å­—ã‚’å†…éƒ¨çš„ã«å°æ–‡å­—ã«å¤‰æ›ã—ã¦æ¯”è¼ƒã‚’è¡Œã†ï¼‰
- âœ”ï¸ ãƒšãƒ¼ã‚¸é·ç§»ãªã—ã®çµã‚Šè¾¼ã¿æ¤œç´¢ã‚’è¡Œã†

ã“ã‚Œã‚‰ã‚’å…ƒã«æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

## ãƒ“ãƒ«ãƒ‰æ™‚ã«JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã™

å„è¨˜äº‹ã«`keywords`ã‚’ç”¨æ„ã—ãŸã‚‰ã€JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã™æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚Gatsbyã®ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹æ™‚ã«JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã®ã§ã€ç·¨é›†ã™ã‚‹ã®ã¯`gatsby-node.js`ã§ã™ã­ã€‚

ã¾ãšã¯ã€å…¨ã¦ã®è¨˜äº‹ã®`frontmatter`ã®`keywords`é …ç›®ã‚’å–å¾—ã™ã‚‹GraphQLã‚¯ã‚¨ãƒªãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```typescript:title=gatsby-node.js
const createPages = async ({ graphql, actions, reporter }) => {

  const queryResult = await graphql(
    `
      ...ç•¥
      {
        # å…¨ã¦ã®è¨˜äº‹ã‚’å–å¾—(æ¤œç´¢ç”¨)
        allArticlesForSearching: allMarkdownRemark(
          sort: {fields: frontmatter___postdate, order: DESC}
        ) {
          edges {
            node {
              fields {
                slug
              }
              frontmatter {
                keywords
                title
              }
            }
          }
        }
      }
    `
```

JSONãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãå‡ºã—ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡Œã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆã¯ãƒ«ãƒ¼ãƒˆç›´ä¸‹ã®`static`ã€ãƒ•ã‚¡ã‚¤ãƒ«åã¯`keywordSearch.json`ã«ã—ã¾ã—ãŸã€‚

```typescript:title=gatsby-node.js
  const keywords = queryResult.data.allArticlesForSearching.edges.map(({node}) => {
    return {
      slug: node.fields.slug,
      title: node.frontmatter.title,
      keywords: node.frontmatter.keywords,
    }
  })

  fs.writeFileSync('./static/keywordSearch.json', JSON.stringify(keywords, null, 2))
```

ã“ã“ã§`gatsby develop`ã™ã‚‹ã¨ã€`static/keywordSearch.json`ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ãã®å†…å®¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

```json:title=/static/keywordSearch.json
[
  {
    "slug": "/Others/01/",
    "title": "ãƒ—ãƒ­ã‚­ã‚·ç’°å¢ƒã§Kali Linuxã‚’ä½¿ã†",
    "keywords": [
      "Kali Linux",
      "WSL2",
      "Proxy",
      "ãƒ—ãƒ­ã‚­ã‚·",
      "apt",
      "wget",
      "curl"
    ]
  },
  //...ç•¥
]
```

## gatsby-transformer-jsonã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã§ããŸã®ã§ã€æ¬¡ã¯ã“ã‚Œã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚Gatsbyã«ã¯`gatsby-transformer-json`ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§GraphQLã‚¯ã‚¨ãƒªãƒ¼ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã§ãã¾ã™ã€‚æ—©é€Ÿã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

ãªãŠã€`gatsby-transformer-json`ã¯ã€2022å¹´1æœˆç¾åœ¨`^4.4.0`ãŒæœ€æ–°ãªã‚ˆã†ã§ã™ãŒã€Gatsby v3ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç’°å¢ƒã ã¨ã€Œwarn Plugin gatsby-transformer-json is not compatible with your gatsby version 3.12.1 - It requires gatsby@^4.0.0-nextã€ã¿ãŸã„ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã¯ãšã§ã™ã€‚

Gatsby v4ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã‚ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€Gatsby v3ã‚’ä½¿ç”¨ä¸­ã®æ–¹ã¯`gatsby-transformer-json@^3.0.0`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

```shell
$ yarn add gatsby-transformer-json@^3.0.0
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‚‰ã€ã¾ãšã¯`gatsby-config.js`ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®éƒ¨åˆ†ã«è¿½è¨˜ã—ã¾ã™ã€‚

```javascript:title=gatsby-config.js
module.exports = {
  plugins: [
    `gatsby-transformer-json`,
    // ...ç•¥
  ]    
```

ã¾ãŸã€`static`ã®ä¸­ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ã‚ã‘ã§ã™ã‹ã‚‰ã€`gatsby-source-filesystem`ã«ãŠã„ã¦`static`ã¸ã®è¨­å®šã‚’ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è¨­å®šãŒå‡ºæ¥ã¦ã„ãªã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½è¨˜ã—ã¾ã™ã€‚

```javascript
  // è¿½è¨˜
  {
    resolve: `gatsby-source-filesystem`,
    options: {
      // ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’æŒ‡å®š
      path: `static`,
      // ä»»æ„ã®åå‰ã‚’ä»˜ã‘ã‚‹
      name: `keywordSearch`,
    },
  },
```

ã“ã“ã§å†åº¦`gatsby develop`ã‚’è¡Œã„ã€`localhost:8000/___graphql`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€GraphiQLã§Graphqlã‚¯ã‚¨ãƒªãƒ¼ã‚’ç™ºè¡Œã—ã€JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã§ãã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒªãƒ¼ã®åå‰ã§ã™ãŒã€ä¿å­˜ã—ã¦ã„ã‚‹JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«åãŒè¸è¥²ã•ã‚Œã¾ã™ã€‚ä»Šå›ã¯`keywordSearch.json`ã¨ã„ã†åå‰ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã®ã§ã€`allKeywordSearchJson`ãªã„ã—`keywordSearchJson`ã¨ã„ã†ã‚¯ã‚¨ãƒªãƒ¼ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

![](./images/image04.png)

GraphQLã‚¯ã‚¨ãƒªãƒ¼ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æŠ•ã’ã¾ã™ã€‚å–å¾—ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ãŒã€è‚å¿ƒã®`keywords`ã¨ã€æ¤œç´¢ã§ãƒ’ãƒƒãƒˆã—ãŸè¨˜äº‹ã¸ã®ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«`slug`ã¨`title`ã‚‚å¿…è¦ã§ã™ã€‚

```graphql
query MyQuery {
  allKeywordSearchJson {
    edges {
      node {
        keywords
        slug
        title
      }
    }
  }
}

```

ã‚¯ã‚¨ãƒªãƒ¼ã‚’å®Ÿè¡Œã—ã¦å³å´ã®ãƒšã‚¤ãƒ³ã«ã‚¨ãƒ©ãƒ¼ãªãçµæœãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ã€‚ä»¥ä¸‹ã¯ç­†è€…ã®ç’°å¢ƒã§ã®ã‚¯ã‚¨ãƒªãƒ¼ã®çµæœã§ã™ã€‚

```javascript:title=Graphqlã‚¯ã‚¨ãƒªãƒ¼ã®çµæœ
{
  "data": {
    "allKeywordSearchJson": {
      "edges": [
        {
          "node": {
            "keywords": [
              "Kali Linux",
              "WSL2",
              "Proxy",
              "ãƒ—ãƒ­ã‚­ã‚·ãƒ¼",
              "apt",
              "wget",
              "curl"
            ],
            "slug": "/Others/01/",
            "title": "ãƒ—ãƒ­ã‚­ã‚·ç’°å¢ƒã§Kali Linuxã‚’ä½¿ã†"
          }
        },
        // ...ä»¥ä¸‹ã€åŒæ§˜ã«ç¶šã
      ]
    }
  },
}
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹

ã“ã“ã¾ã§ãã‚Œã°ç›®çš„ã®å¤§åŠã¯é”æˆã—ãŸã‚‚åŒç„¶ã§ã™ã€‚è¨˜äº‹ã‚’æ¤œç´¢ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚`src/components/keywordSearch.jsx`ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã¾ãšã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¦ãŠãã¾ã™ã€‚

```jsx:title=src/components/keywordSearch.jsx
import React from "react"

export const KeywordSearch = () => {
  return (
    <p>This is a search component</p>
  )
}
```

æ¬¡ã«ã€GraphQLã‚¯ã‚¨ãƒªãƒ¼ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã‚¯ã‚¨ãƒªãƒ¼ã‚’æŠ•ã’ã‚‹ã‚ã‘ã§ã™ã‹ã‚‰`useStaticQuery`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚`useStaticQuery`ã¨`graphql`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚é©å½“ãªæ‰€ã«`console.log(allKeywordSearchJson)`ã‚’ä»•è¾¼ã¿ã€çµæœã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```jsx:title=src/components/KeywordSearch.jsx
import React from "react"
import {useStaticQuery, graphql} from "gatsby"

export const KeywordSearch = () => {
  const {allKeywordSearchJson} = useStaticQuery(
    graphql`
      {
        allKeywordSearchJson {
          edges {
            node {
              keywords
              slug
              title
            }
          }
        }
      }
    `
  )

  console.log(allKeywordSearchJson)

  return (
    <p>This is a search component</p>
  )
}
```

ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ããŸã‚‰ã€é©å®œ`src/components/layout.jsx`ãªã©ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```jsx:title=src/components/layout.jsx
import React, { ReactNode } from "react"

import { KeywordSearch } from "./keywordSearch"

const Layout = ({children}) => (
  <>
    <KeywordSrarch />

    {children}
  </>
)

export default Layout
```

`gatsby develop`ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã€ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§çµæœã‚’ç¢ºèªã—ã¾ã™ã€‚

![](/images/image05.png)

---

ä»Šå›ã€UIã®ä½œæˆã«ã¯`useState`ã¨`useEffect`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã¾ãšã¯`useState`ã§å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’ä¿æŒã™ã‚‹Stateã¨ã€æ¡ä»¶ã«ã‚ˆã£ã¦çµã‚Šè¾¼ã¾ã‚ŒãŸè¨˜äº‹ã™ã¹ã¦ã‚’ä¿æŒã™ã‚‹Stateã‚’ç”¨æ„ã—ã¾ã™ã€‚

ã¤ã„ã§ã«å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚‚æ›¸ã„ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```jsx:title=src/components/KeyWordSearch.jsx
import React, {useState, useEffect} from "react"
import { useStaticQuery, graphql } from "gatsby"

export const KeywordSearch = () => {
  // ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’ä¿æŒã™ã‚‹State
  const [inputtedWords, setInputtedWords] = useState("")

  // æ¡ä»¶ã«ã‚ˆã£ã¦çµã‚Šè¾¼ã¾ã‚ŒãŸè¨˜äº‹ã‚’ä¿æŒã™ã‚‹State
  const [filteredPosts, setFilteredPosts] = useState(null)

  const { allKeywordSearchJson } = useStaticQuery(
    graphql`
      {
        allKeywordSearchJson(skip: 3) {
          edges {
            node {
              keywords
              slug
              title
            }
          }
        }
      }
    `
  )

  return (
    <input type="text" />
  )
}
```

ä»Šå›ã¯ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒã§ã™ã‹ã‚‰ã€å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã«1æ–‡å­—å…¥åŠ›ã•ã‚Œã‚‹ãŸã³ã«GraphQLã‚¯ã‚¨ãƒªãƒ¼ã®çµæœãŒå…¥ã£ã¦ã„ã‚‹`allSearchJson`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’èµ°æŸ»ã—ã¦ã€çµæœã‚’æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãšã¯inputè¦ç´ ã«`onChange`å±æ€§ã‚’å®šç¾©ã—ã€å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’`setInputtedKeywords`ã«æ¸¡ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```jsx:title=src/components/KeywordSearch.jsx
  return (
    <input
      type="text"
      // å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã§inputtedKeywordsã‚’æ›´æ–°ã™ã‚‹
      onChange={(e) => setInputtedWords(e.target.value)}
    />
  )
```

ç¶šã‘ã¦ã€`useEffect`ã‚’å®šç¾©ã—ã€ç¬¬äºŒå¼•æ•°ã«`inputtedWords`ã‚’æ¸¡ã—ã¾ã™ã€‚ã“ã‚Œã§å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«1æ–‡å­—æ›¸ãè¾¼ã¾ã‚Œã‚‹ãŸã³ã«`useEffect`ãŒå®Ÿè¡Œã•ã‚Œã‚‹çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã€‚`useEffect`ã«ã¯`console.log(inputtedWords)`ãªã©ã¨è¨˜è¿°ã—ã€ãƒ•ã‚©ãƒ¼ãƒ ã«1æ–‡å­—å…¥åŠ›ã•ã‚Œã‚‹ãŸã³ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```jsx:title=src/components/KeywordSearch.jsx
export const KeywordSearch = () => {
  //...ç•¥

  // ãƒ•ã‚©ãƒ¼ãƒ ã«æ–‡å­—åˆ—ãŒå…¥åŠ›ã•ã‚Œã‚‹ãŸã³ã«å®Ÿè¡Œã•ã‚Œã‚‹
  useEffect(() => {
    console.log(inputtedWords)

    // ã“ã“ã«inputtedWordsã®ä¸­èº«ã‚’ä½¿ã£ã¦JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ°æŸ»ã—ã€
    // filteredPostsã‚’æ›¸ãæ›ãˆã‚‹å‡¦ç†ã‚’æ›¸ã

  }, [inputtedWords])
```

![](./images/image06.png)

ãã‚Œã§ã¯`useEffect`ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ä»Šå›ã€ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®æ¤œç´¢ã¯ã‚±ãƒ¼ã‚¹ãƒ»ã‚¤ãƒ³ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ã«å®Ÿè£…ã™ã‚‹ã®ã§ã€å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’å…¨ã¦å°æ–‡å­—ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’å…¨ã¦å°æ–‡å­—ã«å¤‰æ›ã—`lowerCaseWords`ã¨ã„ã£ãŸå¤‰æ•°ã«**é…åˆ—ã¨ã—ã¦**ä¿ç®¡ã—ã¾ã™ã€‚

è¤‡æ•°ã®æ–‡å­—ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã«ANDæ¤œç´¢ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€å–ã‚Šå›ã—ãŒã—ã‚„ã™ã„ã‚ˆã†ã«é…åˆ—ã«ã—ã¦ã„ã¾ã™ã€‚

```jsx:title=src/components/KeywordSearch.jsx
useEffect(() => {
  // å…¥åŠ›ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å°æ–‡å­—ã«å¤‰æ›ã™ã‚‹
  const lowerCaseWords = inputtedWords
    .trim()
    .toLocaleLowerCase()
    .match(/[^\s]+/g)

  console.log(lowerCaseWords)
}, [inputtedWords])
```

ä»¥ä¸‹ã®ç”»åƒã¯ã€`Hello World`ã¨å…¥åŠ›ã—ãŸæ™‚ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã®æ§˜å­ã§ã™ã€‚ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆãŒå°æ–‡å­—ã«å¤‰æ›ã•ã‚Œã€å˜èªã”ã¨ã«é…åˆ—ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

![](./images/image07.png)

---

```jsx:title=src/components/keywordSearch.jsx
// ãƒ’ãƒƒãƒˆã—ãŸè¨˜äº‹ãŒã“ã“ã«æ ¼ç´ã•ã‚Œã‚‹
const searchedResult = // æ¤œç´¢å‡¦ç†ã‚’æ›¸ã
```

è‚å¿ƒã®ãƒ’ãƒƒãƒˆã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹éƒ¨åˆ†ã§ã™ãŒã€ç§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¾ã—ãŸã€‚

```jsx:title=src/components/keywordSearch.jsx
// ãƒ’ãƒƒãƒˆã—ãŸè¨˜äº‹ãŒã“ã“ã«æ ¼ç´ã•ã‚Œã‚‹
const searchedResult = allKeywordSearchJson.edges.filter(({node}) => {
  return lowerCaseWords?.every((word) => {
    return node?.keywords?.toString().toLocaleLowerCase().includes(word)
  })
})

// çµæœç¢ºèªç”¨
console.log(lowerCaseWords, searchedResult)
```

ã“ã‚Œã§1æ–‡å­—æ‰“ã¤ãŸã³ã«æ¤œç´¢ãŒè¡Œã‚ã‚Œã€çµæœãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

![](images/image08.png)

ã“ã®`searchedResult`ã‚’ã€æ¤œç´¢çµæœã‚’ä¿æŒã™ã‚‹stateã§ã‚ã‚‹`filteredPosts`ã«ä»£å…¥ã—ã¾ã™ã€‚

```jsx:title=src/components/keywordSearch.jsx
  // çµã‚Šè¾¼ã¾ã‚ŒãŸè¨˜äº‹ä¸€è¦§ã§æ›´æ–°ã™ã‚‹
  setFilteredPosts(searchedResult.length ? searchedResult : null)
```

æœ€å¾Œã«ã€ãƒ’ãƒƒãƒˆã—ãŸè¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹éƒ¨åˆ†ã‚’æ›¸ã‘ã°å®Œæˆã§ã™ã€‚ã“ã“ã§ã¯`ul`è¦ç´ ã¨`li`è¦ç´ ã€`aè¦ç´ `ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

ã²ã¨ã¾ãšå‡ºåŠ›çµæœã‚’ç¢ºèªã—ãŸã„ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```jsx:title=src/components/keywordSearch.jsx
  return (
    <>
      <input
        type="text"
        onChange={(e) => setInputtedWords(e.target.value)}
      />

      <ul>
        {filteredPosts && filteredPosts.map((post) => {
          return (
            <li>
              {post.node.title}
            </li>
          )
        })}
      </ul>
    </>
  )
```

![](images/image09.png)

æ­£ã—ãè¨˜äº‹ãƒªã‚¹ãƒˆãŒå‡ºåŠ›ã•ã‚Œã‚Œã°OKã§ã™ã€‚

å¾Œã¯`Link`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€

```jsx:title=src/components/keywordSearch.jsx
import React, { useState, useEffect } from "react"
import { useStaticQuery, graphql, Link } from "gatsby"

// ...ç•¥
```

`slug`ã‚’ä½¿ã£ã¦ãƒ‘ã‚¹ã‚’è¨˜è¿°ã™ã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚

```jsx:title=src/components/keywordSearch.jsx
  return (
    <>
      <input
        type="text"
        onChange={(e) => setInputtedWords(e.target.value)}
      />

      <ul>
        {filteredPosts && filteredPosts.map((post) => {
          return (
            <li style={{"fontSize": "140%"}}>
              <Link
                to={post.node.slug}
                key={post.node.slug}
              >
                {post.node.title}
              </Link>
            </li>
          )
        })}
      </ul>
    </>
  )
```

ã¡ã‚ƒã‚“ã¨ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã€æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

![](images/image10.png)

ã“ã‚Œã§åŸºæœ¬æ©Ÿèƒ½ã¯å®Œæˆã§ã™ã€‚UIã‚‚ä½•ã‚‚ã‚ã£ãŸã‚‚ã‚“ã˜ã‚ƒãªã„ã§ã™ãŒã€ã“ã‚Œã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã„ã‘ã°å®Ÿç”¨çš„ãªæ¤œç´¢æ©Ÿèƒ½ã¨ã—ã¦ä½¿ãˆã‚‹ã¯ãšã§ã™ã€‚

`src/components/keywordSearch.jsx`ã®ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’ç½®ã„ã¦ãŠãã¾ã™ã€‚

```jsx:title=src/components/keywordSearch.jsx
import React, { useState, useEffect } from "react"
import { useStaticQuery, graphql, Link } from "gatsby"

export const KeywordSearch = () => {
  // ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’ä¿æŒã™ã‚‹State
  const [inputtedWords, setInputtedWords] = useState("")

  // æ¡ä»¶ã«ã‚ˆã£ã¦çµã‚Šè¾¼ã¾ã‚ŒãŸè¨˜äº‹ã‚’ä¿æŒã™ã‚‹State
  const [filteredPosts, setFilteredPosts] = useState(null)

  // ãƒ•ã‚©ãƒ¼ãƒ ã«æ–‡å­—åˆ—ãŒå…¥åŠ›ã•ã‚Œã‚‹ãŸã³ã«å®Ÿè¡Œã•ã‚Œã‚‹
  useEffect(() => {
    // å…¥åŠ›ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å°æ–‡å­—ã«å¤‰æ›ã™ã‚‹
    const lowerCaseWords = inputtedWords
      .trim()
      .toLocaleLowerCase()
      .match(/[^\s]+/g)
    
    // ãƒ’ãƒƒãƒˆã—ãŸè¨˜äº‹ãŒã“ã“ã«æ ¼ç´ã•ã‚Œã‚‹
    const searchedResult = allKeywordSearchJson.edges.filter(({node}) => {
      return lowerCaseWords?.every((word) => {
        return node?.keywords?.toString().toLocaleLowerCase().includes(word)
      })
    })

    // çµã‚Šè¾¼ã¾ã‚ŒãŸè¨˜äº‹ä¸€è¦§ã§æ›´æ–°ã™ã‚‹
    setFilteredPosts(searchedResult.length ? searchedResult : null)
  }, [inputtedWords])

  const { allKeywordSearchJson } = useStaticQuery(
    graphql`
      {
        allKeywordSearchJson(skip: 3) {
          edges {
            node {
              keywords
              slug
              title
            }
          }
        }
      }
    `
  )

  return (
    <>
      <input
        type="text"
        onChange={(e) => setInputtedWords(e.target.value)}
      />

      <ul>
        {filteredPosts && filteredPosts.map((post) => {
          return (
            <li style={{"fontSize": "140%"}}>
              <Link
                to={post.node.slug}
                key={post.node.slug}
              >
                {post.node.title}
              </Link>
            </li>
          )
        })}
      </ul>
    </>
  )
}
```

## ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ç·¨é›†ã§`gatsby develop`ãŒæ­»ã¬

ã‚ã‚‹æ™‚ã‹ã‚‰ã€`gatsby develop`ä¸­ã«ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’ç·¨é›†ã™ã‚‹ã¨ãƒ—ãƒ­ã‚»ã‚¹ãŒæ­»ã¬ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```shell
info changed file at C:\github\GatsbyBlog\static\keywordSearch.json
success extract queries from components - 0.108s
success write out requires - 0.002s
success Writing page-data.json files to public directory - 0.000s - 0/44
119144.33/s

 ERROR

Panicking because nodes appear to be being changed every time we run queries.
This would cause the site to recompile infinitely.
Check custom resolvers to see if they are unconditionally creating or mutating
nodes on every query.
This may happen if they create nodes with a field that is different every time,
such as a timestamp or unique id.
```

å‰è¿°ã®ã¨ãŠã‚Šã€`gatsby-node.js`ã§ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŸºã«JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã‚ã‘ã§ã™ãŒã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã‚’ãã£ã‹ã‘ã«ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãŒèµ°ã‚Šã€JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”ŸæˆãŒç„¡é™ãƒ«ãƒ¼ãƒ—ã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚å½“åˆã¯ã“ã‚“ãªã“ã¨èµ·ããªã‹ã£ãŸã¨æ€ã†ã‚“ã§ã™ãŒã€ã„ã¤ã‹ã‚‰ã‹ã“ã†ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸğŸ˜­ï¼ˆè¡€æ¶™ï¼‰ã€‚

ãŸã ã€æœ¬ç•ªç’°å¢ƒã§èµ·ãã‚‹ã‚¨ãƒ©ãƒ¼ã§ã¯ãªããã“ã¾ã§ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªå•é¡Œã§ã¯ãªã‹ã£ãŸã“ã¨ãŒæ•‘ã„ã§ã™ã€‚

ç’°å¢ƒå¤‰æ•°`process.env.NODE_ENV`ã‚’åˆ©ç”¨ã™ã‚Œã°ã€GatsbyãŒã©ã®ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã‚’å–ã‚Šå‡ºã›ã¾ã™ã€‚`gatsby develop`ãªã‚‰`development`ã€`gatsby build`ãªã‚‰`production`ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚

ä»Šå›ã¯`gatsby-node.js`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã€æœ¬ç•ªç’°å¢ƒæ™‚ï¼ˆ`gatsby build`ãŒå®Ÿè¡Œã•ã‚ŒãŸæ™‚ï¼‰ã®ã¿JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã‚’è¡Œã†ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

```javascript:title=gatsby-node.js
  // æœ¬ç•ªç’°å¢ƒã®ã¿JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã‚’è¡Œã†
  if(process.env.NODE_ENV === 'production') {
    const keywords = queryResult.data.allArticlesForSearching.edges.map(({node}) => {
      return {
        slug: node.fields.slug,
        title: node.frontmatter.title,
        keywords: node.frontmatter.keywords,
      }
    })

    fs.writeFileSync('./static/keywordSearch.json', JSON.stringify(keywords, null , 2))
  }
```

ãƒ­ãƒ¼ã‚«ãƒ«ã§`gatsby develop`ã—ã¦ã„ã‚‹æ™‚ã«ã¯frontmatterã®`keywords`ã‚’æ›¸ãæ›ãˆã‚‹é »åº¦ã¯å¤šããªã„ã§ã™ã—ã€æ›¸ãæ›ãˆãŸã¨ã—ã¦ã‚‚ä¸€åº¦`gatsby build`ã™ã‚Œã°JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æœ€æ–°ã«ã§ãã¾ã™ã€‚

ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ™‚ã«ã¯`gatsby build`ãŒè¡Œã‚ã‚Œã¾ã™ã®ã§ã€æœ¬ç•ªç’°å¢ƒã§ã¯JSONãƒ•ã‚¡ã‚¤ãƒ«ã¯ã¡ã‚ƒã‚“ã¨æœ€æ–°ã«ãªã£ã¦ã„ã¾ã™ã€‚







